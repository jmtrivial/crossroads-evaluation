<!DOCTYPE html>
<html lang="fr-FR" class="no-js">
    <head>
        <meta charset="UTF-8">
        <title>Crossroad quality evaluation</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
            
        
        <script>
            function shuffle(array) {
                let currentIndex = array.length,  randomIndex;

                // While there remain elements to shuffle...
                while (currentIndex != 0) {

                    // Pick a remaining element...
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;

                    // And swap it with the current element.
                    [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
                }

                return array;
            }

        
            $(document).ready(function () {
                

                function set_next_question() {
                    $("#nb_processed").text(window.current_question - 1);
                    if (window.current_question != 1) {
                        $("#nb_processed").prop("disabled", false);
                    }
                }

                function set_nb_crossroads(nb) {
                    $("#nb_crossroads").text(nb);
                    $("#settings_nb_crossroads").text(nb);
                }
                
                // init interface
                function start_questions() {
                    $("#main-container>div").css("display", "none");
                    $("#question").css("display", "block");
                    
                    window.current_question = 1;
                    
                    set_next_question();
                }

                function ask_settings() {
                    $("#main-container>div").css("display", "none");
                    $("#settings").css("display", "block");
                }
                
                $("#regular").click(function(evt) {
                    start_questions();
                });

                $("#shuffle").click(function(evt) {
                    shuffle(window.crossroads);
                    start_questions();
                });

                $("#inputFile").on("change", function handleFileSelect(evt) {
                    if (evt == null || evt.target == null || evt.target.files == null || evt.target.files.length == 0) {
                        console.log("no input file");
                        return;
                    }

                    var file = evt.target.files[0];

                    if (file.type != "application/json") {
                        console.log("bad format");
                        return;
                    }
                    
                    const fr = new FileReader();

                    fr.addEventListener("load", e => {
                        $("#main-container>div").css("display", "none");
                        $("#chargement").css("display", "block");
                        window.crossroads = JSON.parse(fr.result);
                        set_nb_crossroads(window.crossroads.length);
                        ask_settings();
                    });

                    fr.readAsText(file);
                });

            });
            
        </script>
        <style>
            #question, #chargement, #settings { display: none; }
            
        </style>

    </head>
	<body>
        <div class="container-xl" id="main-container">
            
            <h1>Crossroad quality evaluation</h1>
             <p class="lead">By answering the following questions, you will evaluate the quality of a junction detection and segmentation algorithm in <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, and participate in the <a href="https://activmap.limos.fr/">ANR ACTIVmap project</a>.
            </p>
            <div id="start">
                 <div class="position-absolute top-50 start-50 translate-middle fs-1">
                        <form>
                                        <p>Select a <code>json</code> file</p>
                        <div class="btn btn-primary btn-block" style="width: 100%">
                                        <label style="padding: 0" tkey="chooseFile">Load crossroads</label>
                                            <input type="file" id="inputFile" name="files[]" accept="application/json" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer; opacity: 0">
                        </div>
                        </form>
                 </div>
            </div>
            <div id="chargement">
                 <div class="position-absolute top-50 start-50 translate-middle fs-1">Chargement des données...</div>
            </div>
            <div id="settings">
                <div class="position-absolute top-50 start-50 translate-middle fs-1 col-6">
                    <p>Do you want to shuffle the <span id="settings_nb_crossroads"></span> crossroads, or evaluate them in regular order?</p>
                    <div class="container mt-3">
                        <div class="row">
                        <div class="col-6">
                            <button id="regular" class="btn btn-primary btn-block form-control" type="button">Regular</button>
                        </div>
                        <div  class="col-6">
                            <button id="shuffle" class="btn btn-primary btn-block form-control" type="button">Shuffle</button>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="question">
                <div class="card">
                    <div class="card-body">
                        <div class="container">
                            <div class="row">
                                <div class="col-6">
                                test
                                </div>
                                <div class="col-6">
                                test
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="container mt-3">
                    <div class="row">
                    <div class="col-6">
                        <button class="btn btn-secondary" type="button" disabled>Download evaluations (<span id="nb_processed">0</span> / <span id="nb_crossroads">-</span>)</button>
                    </div>
                    <div  class="col-6">
                        <button class="btn btn-primary" type="button">Next crossroad</button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
